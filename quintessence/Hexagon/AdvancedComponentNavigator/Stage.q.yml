parent_classes:
  - class: 'StageInterface'
    scope: public
    init_with: "StageInterface::COMPONENT_NAVIGATOR"
properties:
  - name: cursor_position
    type: int
    getter: true
    init_with: 0
  - name: cursor_position_static
    type: bool
    getter: true
    setter: true
    init_with: true
  - name: selector_color
    type: ALLEGRO_COLOR
    init_with: "al_color_name(\"slategray\")"
    getter: true
    setter: true
  - name: project_root
    type: std::string
    init_with: "\"/Users/markoates/Repos/hexagon\""
    constructor_arg: true
    getter: true
    setter: true
  - name: a_default_empty_event
    static: true
    type: ALLEGRO_EVENT
    init_with: "{}"
    getter_ref: true
  - name: nodes
    type: std::vector<Blast::Project::Component>
    init_with: "{}"
    getter: true
    setter: true
  - name: search_text
    type: std::string
    init_with: '""'
    getter: true
    setter: true
  - name: mode
    type: std::string
    init_with: '"navigating_list"'
    getter: true
    setter: true



functions:



  - name: move_cursor_up
    type: void
    body: |
      cursor_position -= 1;



  - name: move_cursor_down
    type: void
    body: |
      cursor_position += 1;



  - name: move_cursor_to_top
    type: void
    body: |
      cursor_position = 0;



  - name: current_selection_is_valid
    type: bool
    body: |
      if (cursor_position < 0 || cursor_position >= nodes.size()) return false;
      return true;



  - name: set_mode_to_navigating_list
    type: void
    body: |
      this->mode = "navigating_list";



  - name: set_mode_to_typing_in_search_bar
    type: void
    body: |
      this->mode = "typing_in_search_bar";



  - name: get_current_selection_label_or_empty_string
    type: std::string
    body: |
      if (!current_selection_is_valid()) return "";
      return nodes[get_cursor_position()].get_name();



  - name: refresh_list
    body: |
      Hexagon::AdvancedComponentNavigator::ComponentSearcher searcher(get_project_root(), search_text);
      nodes = searcher.components_sorted_by_most_recent();
    body_dependency_symbols:
      - Hexagon::AdvancedComponentNavigator::ComponentSearcher



  - name: render
    is_override: true
    parameters:
      - name: is_focused
        type: bool
        default_argument: true
      - name: display
        type: ALLEGRO_DISPLAY*
        default_argument: nullptr
      - name: font
        type: ALLEGRO_FONT*
        default_argument: nullptr
      - name: cell_width
        type: int
        default_argument: 10
      - name: cell_height
        type: int
        default_argument: 20
    body: |
      Hexagon::AdvancedComponentNavigator::Renderer renderer(this, is_focused, font, cell_width, cell_height);
      renderer.render();
      return;
    body_dependency_symbols:
      - Hexagon::AdvancedComponentNavigator::Renderer



  - name: process_local_event
    is_override: true
    parameters:
      - name: event_name
        type: std::string
        default_argument: "\"\""
      - name: action_data
        type: ActionData
        default_argument: "ActionData()"
    body: |
      using Hexagon::AdvancedComponentNavigator::Stage;

      std::map<std::string, std::function<void(Stage&)>> local_events = {
         { "refresh_list", &Stage::refresh_list },
         { "move_cursor_to_top", &Stage::move_cursor_to_top },
         { "move_cursor_up", &Stage::move_cursor_up },
         { "move_cursor_down", &Stage::move_cursor_down },
         { "set_mode_to_navigating_list", &Stage::set_mode_to_navigating_list },
         { "set_mode_to_typing_in_search_bar", &Stage::set_mode_to_typing_in_search_bar },
      };

      Hexagon::AdvancedComponentNavigator::EventController event_controller(this, local_events);
      event_controller.process_local_event(event_name, action_data);
      return;
    body_dependency_symbols:
      - Hexagon::AdvancedComponentNavigator::EventController



  - name: process_char_event
    parameters:
      - name: keycode
        type: int
        default_argument: 0
      - name: unichar
        type: int
        default_argument: 0
      - name: is_repeat
        type: bool
        default_argument: false
    body: |
      if (keycode == ALLEGRO_KEY_BACKSPACE) {}
      else if (keycode == ALLEGRO_KEY_TAB) {}
      else if (keycode == ALLEGRO_KEY_ENTER) {}
      else if (keycode == ALLEGRO_KEY_ESCAPE) {}
      else if (keycode == ALLEGRO_KEY_DELETE) {}
      else
      {
         //search_text += unichar; // <-- for example
      }
      return;



  - name: process_event
    is_override: true
    parameters:
      - name: event
        type: ALLEGRO_EVENT&
        default_argument: "get_a_default_empty_event_ref()"
    body: |
      constexpr auto NO_MODIFIER = KeyboardCommandMapper::NO_MODIFIER;
      constexpr auto SHIFT = KeyboardCommandMapper::SHIFT;
      constexpr auto CTRL = KeyboardCommandMapper::CTRL;
      constexpr auto ALT = KeyboardCommandMapper::ALT;
      constexpr auto COMMAND = KeyboardCommandMapper::COMMAND;
      constexpr auto OPTION = KeyboardCommandMapper::OPTION;

      KeyboardCommandMapper keyboard_command_mapper;

      static const std::string MOVE_CURSOR_TO_TOP = "move_cursor_to_top";
      static const std::string MOVE_CURSOR_UP = "move_cursor_up";
      static const std::string MOVE_CURSOR_DOWN = "move_cursor_down";

      keyboard_command_mapper.set_mapping(ALLEGRO_KEY_J, NO_MODIFIER, { MOVE_CURSOR_DOWN });
      keyboard_command_mapper.set_mapping(ALLEGRO_KEY_K, NO_MODIFIER, { MOVE_CURSOR_UP });

      bool event_caught = false;

      switch(event.type)
      {
      case ALLEGRO_EVENT_KEY_UP:
         break;
      case ALLEGRO_EVENT_KEY_DOWN:
         break;
      case ALLEGRO_EVENT_KEY_CHAR:
         bool shift = event.keyboard.modifiers & ALLEGRO_KEYMOD_SHIFT;
         bool alt = event.keyboard.modifiers & ALLEGRO_KEYMOD_ALT;
         bool ctrl = event.keyboard.modifiers & ALLEGRO_KEYMOD_CTRL;
         bool command = event.keyboard.modifiers & ALLEGRO_KEYMOD_COMMAND;
         bool ctrl_or_command = ctrl || command;
         std::vector<std::string> mapped_events = keyboard_command_mapper.get_mapping(event.keyboard.keycode, shift, ctrl_or_command, alt);
         if (!mapped_events.empty()) event_caught = true;
         for (auto &mapped_event : mapped_events) process_local_event(mapped_event);
         if (!event_caught) process_char_event(event.keyboard.keycode, event.keyboard.unichar, event.keyboard.repeat);
         break;
      }
      return;
    body_dependency_symbols:
      - KeyboardCommandMapper



  - name: save_file
    is_override: true
    type: bool
    body: |
      return true;



dependencies:


  - symbol: Hexagon::AdvancedComponentNavigator::Renderer
    headers: [ Hexagon/AdvancedComponentNavigator/Renderer.hpp ]
  - symbol: Hexagon::AdvancedComponentNavigator::EventController
    headers: [ Hexagon/AdvancedComponentNavigator/EventController.hpp ]
  - symbol: color::mix
    headers: [ 'allegro_flare/color.h' ]
  - symbol: StageInterface
    headers: [ 'Hexagon/StageInterface.hpp' ]
  - symbol: ALLEGRO_DISPLAY*
    headers: [ 'allegro5/allegro.h' ]
  - symbol: ALLEGRO_EVENT&
    headers: [ 'allegro5/allegro.h' ]
  - symbol: ALLEGRO_COLOR
    headers: [ 'allegro5/allegro.h', 'allegro5/allegro_color.h' ]
  - symbol: ALLEGRO_EVENT
    headers: [ 'allegro5/allegro.h' ]
  - symbol: ALLEGRO_FONT*
    headers: [ 'allegro5/allegro_font.h' ]
  - symbol: ActionData
    headers: [ 'Hexagon/ActionData.hpp' ]
  - symbol: al_color_name
    headers: [ 'allegro5/allegro_color.h' ]
  - symbol: std::endl
    headers: [ 'iostream' ]
  - symbol: std::cerr
    headers: [ 'iostream' ]
  - symbol: std::cout
    headers: [ 'iostream' ]
  - symbol: al_draw_circle
    headers: [ 'allegro5/allegro_primitives.h' ]
  - symbol: Blast::Project::Component
    headers: [ Blast/Project/Component.hpp ]
  - symbol: std::vector<Blast::Project::Component>
    headers: [ vector, Blast/Project/Component.hpp ]
  - symbol: std::vector<std::string>
    headers: [ 'vector', 'string' ]
  - symbol: FileSystemNode
    headers: [ 'Hexagon/FileSystemNode.hpp' ]
  - symbol: KeyboardCommandMapper
    headers: [ 'AllegroFlare/KeyboardCommandMapper.hpp' ]
  - symbol: Hexagon::AdvancedComponentNavigator::ComponentSearcher
    headers: [ 'Hexagon/AdvancedComponentNavigator/ComponentSearcher.hpp' ]
  - symbol: Hexagon::Shapes::Hexagon::Renderer
    headers: [ Hexagon/Shapes/Hexagon/Renderer.hpp ]
  - symbol: Hexagon::Shapes::Hexagon::Stroke
    headers: [ Hexagon/Shapes/Hexagon/Stroke.hpp ]
