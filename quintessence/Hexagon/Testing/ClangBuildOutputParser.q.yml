properties:


  - name: clang_build_run_output
    type: std::string
    init_with: '"[unset-clang_build_run_output]"'
    constructor_arg: true

  - name: warnings_and_errors
    type: std::vector<Hexagon::Testing::ClangBuildOutputResult>
    init_with: '{}'
    getter: true

  - name: warnings_and_errors_parsed
    type: bool
    init_with: false
    private: true

  - name: error_messages_during_parsing
    type: std::vector<std::string>
    init_with: '{}'
    getter: true

  - name: lines
    type: std::vector<std::string>
    init_with: '{}'
    private: true

  - name: lines_parsed
    type: bool
    init_with: false
    private: true

  - name: num_warnings_errors_generated_line
    type: std::string
    init_with: '""'
    getter: true

  - name: num_warnings_errors_generated_line_parsed
    type: bool
    init_with: false
    private: true

  - name: NUM_WARNINGS_ERRORS_GENERATED_REGEX
    type: std::string
    init_with: '"[0-9]+ (?:warning[s]?|error[s]?) generated\\."'
    getter: true
    const: true
    static: true

  - name: WARNING_OR_ERROR_REGEX
    type: std::string
    init_with: '"[TODO]"'
    getter: true
    const: true
    static: true

  - name: parsed
    type: bool
    init_with: false
    getter: true


functions:


  - name: parse
    type: void
    body: |
      if (parsed) return;
      parse_split_lines();
      parse_num_warnings_errors_generated_line();
      parse_warnings_and_errors();
      parsed = true;
      return;
    body_dependency_symbols:
      - Blast::StringSplitter


  - name: discard_irrelevant_lines
    type: std::vector<std::string>
    body: |
      // TODO in FUTURE
      return {};


  - name: parse_split_lines
    body: |
      if (lines_parsed) return;
      Blast::StringSplitter splitter(clang_build_run_output, '\n');
      lines = splitter.split();
      return;


  - name: parse_warnings_and_errors
    body: |
      if (warnings_and_errors_parsed) return;
      warnings_and_errors_parsed = true;



      return;


  - name: parse_num_warnings_errors_generated_line
    body: |
      if (num_warnings_errors_generated_line_parsed) return;
      num_warnings_errors_generated_line_parsed = true;

      bool match_found = false;
      for (int line_i=0; line_i<lines.size(); line_i++)
      {
         std::string &this_line = lines[line_i];
         RegexMatcher matcher(this_line, NUM_WARNINGS_ERRORS_GENERATED_REGEX);
         std::vector<std::pair<int, int>> match_info = matcher.get_match_info();
         if (!match_info.empty())
         {
            if (match_info.size() != 1)
            {
               std::cout << "Weird error - expecting just 1 match in a line but there were several." << std::endl;
            }
            else if (match_found)
            {
               std::cout << "Weird error - found another match but one has already been found." << std::endl;
            }
            else
            {
               match_found = true;
               num_warnings_errors_generated_line = this_line;
            }
            //std::cout << "# " << this_line << std::endl;
         }
         else
         {
            //std::cout << ". " << this_line << std::endl;
         }
      }

      return;
    body_dependency_symbols:
      - Hexagon::RegexMatcher
      - std::cout


dependencies:


  - symbol: std::vector<Hexagon::Testing::ClangBuildOutputResult>
    headers: [ vector, Hexagon/Testing/ClangBuildOutputResult.hpp ]
  - symbol: Blast::StringSplitter
    headers: [ Blast/StringSplitter.hpp ]
  - symbol: Hexagon::RegexMatcher
    headers: [ Hexagon/RegexMatcher.hpp ]



