properties:
  - name: font
    type: ALLEGRO_FONT*
    init_with: nullptr
    constructor_arg: true
  - name: font_color
    type: ALLEGRO_COLOR*
    init_with: nullptr
    constructor_arg: true
  - name: x
    type: float
    init_with: 0.0f
    constructor_arg: true
  - name: y
    type: float
    init_with: 0.0f
    constructor_arg: true
  - name: line
    constructor_arg: true
functions:
  - name: build_tokens
    type: std::vector<std::pair<std::string, ALLEGRO_COLOR>>
    private: true
    body: |
      std::vector<std::pair<std::string, ALLEGRO_COLOR>> tokens;
      ALLEGRO_COLOR comment_color = AllegroFlare::color::color(*font_color, 0.3f);

      //std::size_t comment_starts_at = line.find("//");
      std::string comments_not_inside_quotes_regex = "([\"'])(?:\\?+.)*?\1";
      RegexMatcher regex_matcher(line, comments_not_inside_quotes_regex);
      std::vector<std::pair<int, int>> match_info = regex_matcher.get_match_info();

      tokens = { { line, *font_color } };
      return tokens;
  - name: render_tokens
    type: void
    private: true
    parameters:
      - name: tokens
        type: std::vector<std::pair<std::string, ALLEGRO_COLOR>>
        default_argument: "{}"
    body: |
      for (auto &token : tokens)
      {
         std::string &text = std::get<0>(token);
         ALLEGRO_COLOR &color = std::get<1>(token);

         al_draw_text(font, *font_color, x, y, ALLEGRO_ALIGN_LEFT, text.c_str());
      }
  - name: render
    type: void
    body: |
      if (!font)
      {
         std::stringstream error_message;
         error_message << "[Hexagon/Powerbar/Renderer/AdvancedLineRenderer error:] cannot \""
                       << __FUNCTION__ << "\" with a nullptr font";
         throw std::runtime_error(error_message.str());
      }
      if (!font_color)
      {
         std::stringstream error_message;
         error_message << "[Hexagon/Powerbar/Renderer/AdvancedLineRenderer error:] cannot \""
                       << __FUNCTION__ << "\" with a nullptr font_color";
         throw std::runtime_error(error_message.str());
      }

      std::vector<std::pair<std::string, ALLEGRO_COLOR>> tokens = build_tokens();
      render_tokens(tokens);

      return;

    body_dependency_symbols:
      - RegexMatcher
      - AllegroFlare::color::color
      - std::stringstream
      - al_draw_text
      - al_color_name
      - std::get
      - ALLEGRO_ALIGN_LEFT
      - std::vector<std::pair<std::string, ALLEGRO_COLOR>>
dependencies:
  - symbol: AllegroFlare::color::color
    headers: [ AllegroFlare/Color.hpp ]
  - symbol: RegexMatcher
    headers: [ Hexagon/RegexMatcher.hpp ]
  - symbol: std::get
    headers: [ utility ]
  - symbol: std::vector<std::pair<std::string, ALLEGRO_COLOR>>
    headers: [ vector, utility, string, allegro5/allegro_color.h ]
  - symbol: al_draw_text
    headers: [ allegro5/allegro.h ]
  - symbol: al_color_name
    headers: [ allegro5/allegro_color.h ]
  - symbol: ALLEGRO_ALIGN_LEFT
    headers: [ allegro5/allegro.h ]
  - symbol: ALLEGRO_FONT*
    headers: [ allegro5/allegro_font.h ]
  - symbol: ALLEGRO_COLOR*
    headers: [ allegro5/allegro.h ]
