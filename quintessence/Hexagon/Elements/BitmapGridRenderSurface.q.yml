properties:


  - name: num_columns
    type: int
    init_with: 0
    constructor_arg: true
  - name: num_rows
    type: int
    init_with: 0
    constructor_arg: true
  - name: cell_width
    type: int
    init_with: 1
    constructor_arg: true
  - name: cell_height
    type: int
    init_with: 1
    constructor_arg: true
  - name: surface
    type: ALLEGRO_BITMAP*
    init_with: nullptr
    getter: true
  - name: cell_sub_bitmaps
    type: std::vector<ALLEGRO_BITMAP*>
    init_with: '{}'
  - name: initialized
    type: bool
    init_with: false
    getter: true


functions:


  - name: initialize
    type: void
    guards: [ al_is_system_installed() ]
    body: |
      if (initialized) return;

      ALLEGRO_STATE previous_render_state;
      al_store_state(&previous_render_state, ALLEGRO_STATE_TARGET_BITMAP);

      if (surface)
      {
         for (auto &cell_sub_bitmap : cell_sub_bitmaps) al_destroy_bitmap(cell_sub_bitmap);
         al_destroy_bitmap(surface);
         cell_sub_bitmaps.clear();
         surface = nullptr;
      }

      if (!surface)
      {
         surface = al_create_bitmap(num_columns * cell_width, num_rows * cell_height);
         cell_sub_bitmaps.resize(num_columns * num_rows);
         for (unsigned y=0; y<num_rows; y++)
         {
            for (unsigned x=0; x<num_columns; x++)
            {
               ALLEGRO_BITMAP *cell_sub_bitmap =
                 al_create_sub_bitmap(surface, x*cell_width, y*cell_height, cell_width, cell_height);
               cell_sub_bitmaps[x + y*num_columns] = cell_sub_bitmap;
            }
         }
      }
      al_set_target_bitmap(surface);
      al_clear_to_color(ALLEGRO_COLOR{0.0f, 0.0f, 0.0f, 0.0f});

      al_restore_state(&previous_render_state);

      initialized = true;
      return;


  - name: draw_to_surface
    type: void
    parameters:
      - name: bitmap
        type: ALLEGRO_BITMAP*
        default_argument: nullptr
      - name: x
        type: int
        default_argument: 0
      - name: y
        type: int
        default_argument: 0
    guards: [ bitmap ]
    body: |
      ALLEGRO_STATE previous_render_state;
      al_store_state(&previous_render_state, ALLEGRO_STATE_TARGET_BITMAP);

      //al_set_target_bitmap();

      al_restore_state(&previous_render_state);
      return;


  - name: destroy
    type: void
    body: |
      for (auto &cell_sub_bitmap : cell_sub_bitmaps) { if (cell_sub_bitmap) al_destroy_bitmap(cell_sub_bitmap); }
      cell_sub_bitmaps.clear();
      if (surface) al_destroy_bitmap(surface);
      return;


dependencies:


  - symbol: ALLEGRO_BITMAP*
    headers: [ allegro5/allegro.h ]
  - symbol: std::vector<ALLEGRO_BITMAP*>
    headers: [ vector, allegro5/allegro.h ]

